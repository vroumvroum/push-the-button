language: java

#Using the default oracleJdk8 proposed by Travis
jdk:
  - oraclejdk8

#We don't need to retrieve all the commits
git:
  depth: 3

#Secure key is for SONAR_TOKEN
env:
  global:
    - secure: cVA5VriyUReySRsCk850MosmHF4yZF5dUBctkokqH6b5Lp7yUqEj7OtLxzlYDzr+dj0IyyZEKRu/5c+W5DxeLXmh4pAxOGOPnme7QoYLfPpobKphJadC6aJ3Ofx2qnbTOTPax1SQjguvP6SatsayZHsnuDlZjgH7ZBvqF3eGuGH+4Q3AIz9YhR8pRJxs7ogrDz4R3qPwnGlPBR+6JfwhK/zB0Y2fypKAyoKF7EnEjnCYRdKztBjSJYoTTnGuu4+nzSbfqTtloPfedhwT+5+dgmVL1QlCjMgbRxUliYUVhxHCGFFLsQ7kfhFyMK87M7/GepNUd+WIKX/a/39cDeU00M+VZYwmJNz9IRW8aUYbBAGEGYQ+gjFyCXdHLbIPug1HLTEo5lRciue/ghBk+QXMoDz/9LuwjF2/AHLGLyWMS8kvdmvFpRhbptfA8GIYCybYlBdKfpk9qsfT0Hywa4oLaY90ZrBeE4xkGIQGtkx17If6UKzl/b7Qi0EkVKF6IySMT9fz1jwTh6EEIljh+gH1wFVLZfbRhCv2AzYrFlDQPqJb1zfQnkPweNw+tiSlMSOpGLVhtBxbVktG/Bnz15luut/xi6mWvvlBnKK6FbW5v3ruRgSgCLMakWQJGGNJmgzcW/qDRt2bnmj2a6MpVPW9tF4IFIBen85qrtybF4NumOs= 

#Skipping install phase
install: true

#Caching Maven and Sonar work directory to speed up the build
cache:
  directories:
  - "$HOME/.m2"
  - "$HOME/.sonar/cache"

#Activating sonarqube addon (Cf. script phase)
addons:
  sonarqube: true

#Defining how to build. For master environment (stable), we want to make a quality check also
script:
  - mvn clean package 

after_success:
  - mvn clean -X org.jacoco:jacoco-maven-plugin:prepare-agent sonar:sonar -Dsonar.login=$SONAR_TOKEN -Dsonar.projectKey="push-the-button-${TRAVIS_BRANCH}"

deploy:
  provider: releases
  api_key:
    secure: es6vjeATn9WLQlq8Rl5vJNv/ln+AD4qezo5Zt/SRnVW9mvSjONkHsvnpnMhbXHB6u96XyE4Fp/VHoe6TDwYGnG3IZz8fJlleLgrJK1ZjDHjqLQD7l3a4ftF2uRwHJ1s1cFyW+QjWNPQWIqJE/rCicr5F3T0tm6vij52BS2ejc/CsLD2/9cfHbssE4u8/nD6QQOIVyjlanrf+hDigETr0QRcrEq9S05qxwaidc0NHVoaSrq2c1gADxE+bGqExePawRdBOxAl6voPgtRYT63MKApDf+TkLe6S2PMpLdNQC57Lc29bMDrdIOTcZblyRoK2MLohQzMl3RKAKyr6soTVwWagOIVsHnIcqXfKBMOxu+uQA5JTLkCEdo69O3pMFYMxNvRYxW5gYVjlAOKNHuwUqwdGIZh4PLm4aBOU/b/ZpO+1wYE3v2dWYI0+KKC4fns+5LC2cH+HrSja5qc+7v3ZoyNPVQWYip1vb075odjFSaezTo1GlKrUF/pe6INlr+2e8i3udc89scEEPJ2zyAOdsQMP2vIaBKRNocRp+thIGq6CSC7J0OtD/Bx24lPMPcFSahL7EFGt7ZQBwnxxbzFyC0Om69nMtQ5jr+pNXtxQclvHuJIvTE54qxiFhbhaAiF9MtkkC97hD+zk84hTlJgRLRRG7s6rKgCM+chMnNgKqGyY= 
  file: target/clickCount.war
  skip_cleanup: true
  on:
    tags: true
